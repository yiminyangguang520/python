__author__ = 'ypw'

urls = """http://mynoise.net/NoiseMachines/greyNoiseGenerator.php
http://mynoise.net/NoiseMachines/audioJammerNoiseGenerator.php
http://mynoise.net/NoiseMachines/telecasterLicksMusicGenerator.php
http://mynoise.net/NoiseMachines/enchantedForestSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/bilateralBrainwaveGenerator.php
http://mynoise.net/NoiseMachines/myNoisliSoundGenerator.php
http://mynoise.net/NoiseMachines/greyNoiseGenerator.php
http://mynoise.net/NoiseMachines/impulseNoiseGenerator.php
http://mynoise.net/NoiseMachines/sweepNoiseGenerator.php
http://mynoise.net/NoiseMachines/transistorRhythmGenerator.php
http://mynoise.net/NoiseMachines/whiteNoiseGenerator.php
http://mynoise.net/NoiseMachines/auralScannerNoiseGenerator.php
http://mynoise.net/NoiseMachines/bilateralBrainwaveGenerator.php
http://mynoise.net/NoiseMachines/binauralBrainwaveGenerator.php
http://mynoise.net/NoiseMachines/pureBinauralBrainwaveGenerator.php
http://mynoise.net/NoiseMachines/isochronicBrainwaveGenerator.php
http://mynoise.net/NoiseMachines/shepardAudioIllusionToneGenerator.php
http://mynoise.net/NoiseMachines/solfeggioTonesGenerator.php
http://mynoise.net/NoiseMachines/cabinNoiseGenerator.php
http://mynoise.net/NoiseMachines/dataCenterNoiseGenerator.php
http://mynoise.net/NoiseMachines/demolitionWorkNoiseGenerator.php
http://mynoise.net/NoiseMachines/fanNoiseGenerator.php
http://mynoise.net/NoiseMachines/fireworksNoiseGenerator.php
http://mynoise.net/NoiseMachines/50HzFishTankNoiseGenerator.php
http://mynoise.net/NoiseMachines/60HzFishTankNoiseGenerator.php
http://mynoise.net/NoiseMachines/raceCarsNoiseGenerator.php
http://mynoise.net/NoiseMachines/50HzHumNoiseGenerator.php
http://mynoise.net/NoiseMachines/60HzHumNoiseGenerator.php
http://mynoise.net/NoiseMachines/laundromatNoiseGenerator.php
http://mynoise.net/NoiseMachines/railroadNoiseGenerator.php
http://mynoise.net/NoiseMachines/trafficNoiseGenerator.php
http://mynoise.net/NoiseMachines/dustyScratchedVinylNoiseGenerator.php
http://mynoise.net/NoiseMachines/isabelleKnightHypnosisTalkGenerator.php
http://mynoise.net/NoiseMachines/airportTerminalNoiseGenerator.php
http://mynoise.net/NoiseMachines/audioJammerNoiseGenerator.php
http://mynoise.net/NoiseMachines/babbleNoiseGenerator.php
http://mynoise.net/NoiseMachines/cafeRestaurantNoiseGenerator.php
http://mynoise.net/NoiseMachines/himalayanVoicesSongGenerator.php
http://mynoise.net/NoiseMachines/evilCharmRPGSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/zarinaKopyrinaVocalSoundscape.php
http://mynoise.net/NoiseMachines/rainNoiseGenerator.php
http://mynoise.net/NoiseMachines/catPurrNoiseGenerator.php
http://mynoise.net/NoiseMachines/caveWaterNoiseGenerator.php
http://mynoise.net/NoiseMachines/windSeaRainNoiseGenerator.php
http://mynoise.net/NoiseMachines/waterSpringStreamNoiseGenerator.php
http://mynoise.net/NoiseMachines/caveExplorationNoiseGenerator.php
http://mynoise.net/NoiseMachines/saharaWindNoiseGenerator.php
http://mynoise.net/NoiseMachines/thunderNoiseGenerator.php
http://mynoise.net/NoiseMachines/fireNoiseGenerator.php
http://mynoise.net/NoiseMachines/jungleNoiseGenerator.php
http://mynoise.net/NoiseMachines/oceanNoiseGenerator.php
http://mynoise.net/NoiseMachines/campingRainNoiseGenerator.php
http://mynoise.net/NoiseMachines/ultrasonicNoiseGenerator.php
http://mynoise.net/NoiseMachines/tropicalForestAtDawnSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/tinRoofRainNoiseGenerator.php
http://mynoise.net/NoiseMachines/waterStreamNoiseGenerator.php
http://mynoise.net/NoiseMachines/waterfallNoiseGenerator.php
http://mynoise.net/NoiseMachines/whiteRainNoiseGenerator.php
http://mynoise.net/NoiseMachines/windNoiseGenerator.php
http://mynoise.net/NoiseMachines/myNoisliSoundGenerator.php
http://mynoise.net/NoiseMachines/churchAtmosphereSoundGenerator.php
http://mynoise.net/NoiseMachines/froggyPondSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/farmSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/ferryboatSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/propellerNoiseGenerator.php
http://mynoise.net/NoiseMachines/grasslandSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/healingWaterSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/inUteroSoundGenerator.php
http://mynoise.net/NoiseMachines/palmGardenAtNightSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/palmGardenSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/howlingParaglideSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/prehistoricCavemenMusicGenerator.php
http://mynoise.net/NoiseMachines/battlefieldRPGSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/enchantedForestSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/dungeonRPGSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/poltergeistRPGSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/rainyRiverbankSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/squeakingSailboatSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/spaceshipNoiseGenerator.php
http://mynoise.net/NoiseMachines/springWalkSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/deepOceanSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/tibetSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/finWhaleUnderwaterSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/winterSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/anamnesisSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/bagpipesDroneGenerator.php
http://mynoise.net/NoiseMachines/canyonDroneGenerator.php
http://mynoise.net/NoiseMachines/didgeridooDroneGenerator.php
http://mynoise.net/NoiseMachines/infiniteChoirDroneGenerator.php
http://mynoise.net/NoiseMachines/iceDroneGenerator.php
http://mynoise.net/NoiseMachines/indianDroneGenerator.php
http://mynoise.net/NoiseMachines/northernLightsDroneGenerator.php
http://mynoise.net/NoiseMachines/orchestronDroneGenerator.php
http://mynoise.net/NoiseMachines/shrutiBoxDroneGenerator.php
http://mynoise.net/NoiseMachines/singingBowlsDroneGenerator.php
http://mynoise.net/NoiseMachines/stardustDroneGenerator.php
http://mynoise.net/NoiseMachines/tanpuraDroneGenerator.php
http://mynoise.net/NoiseMachines/throatSingingDroneGenerator.php
http://mynoise.net/NoiseMachines/magicAcousticGenerator.php
http://mynoise.net/NoiseMachines/magicEerieGenerator.php
http://mynoise.net/NoiseMachines/magicWaterGenerator.php
http://mynoise.net/NoiseMachines/magicNatureGenerator.php
http://mynoise.net/NoiseMachines/magicRainyDaysGenerator.php
http://mynoise.net/NoiseMachines/magicSirenSongGenerator.php
http://mynoise.net/NoiseMachines/magicSpaceGenerator.php
http://mynoise.net/NoiseMachines/magicMeditationGenerator.php
http://mynoise.net/NoiseMachines/tripOfMindNoiseGenerator.php
http://mynoise.net/NoiseMachines/circularBreathSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/desertedSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/rhodesSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/oblivionSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/osmosisDroneGenerator.php
http://mynoise.net/NoiseMachines/frankHellNoiseGenerator.php
http://mynoise.net/NoiseMachines/danaFortierSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/telecasterLicksMusicGenerator.php
http://mynoise.net/NoiseMachines/windchimesGenerator.php
http://mynoise.net/NoiseMachines/eastAsiaTonalSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/twilightSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/bambooChimesGenerator.php
http://mynoise.net/NoiseMachines/polyrhythmBeatGenerator.php
http://mynoise.net/NoiseMachines/stalactitesCaveChimeSoundscapeGenerator.php
http://mynoise.net/NoiseMachines/clockTickTockNoiseGenerator.php
http://mynoise.net/NoiseMachines/codeBreakerNoiseGenerator.php
http://mynoise.net/NoiseMachines/numberStationsRadioNoiseGenerator.php
http://mynoise.net/NoiseMachines/shortwaveRadioTunerNoiseGenerator.php"""
urls = urls.split('\n')

import requests
import re
import os
import time
import socket
socket.setdefaulttimeout(1)
s = requests.session()
s.headers["User-Agent"] = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/44.0.2403.130 Safari/537.36"
# s.headers["Cookie"] = 'uSET_unlogged={"CAL":"41572625493025222027"}; _gat=1; bubble=1007; timeIn=FIRE; _ga=GA1.2.1540143227.1453129887'
http_agent = 'http://wzq.hk:1996'
proxies = {'http': http_agent, 'https': http_agent}
proxies = {}

for url in urls:
    print url
    html = requests.get(url, proxies=proxies).text
    p = re.compile(r'(http://cdn\.mynoise\.net/Data/.+?)\'')
    url2s = p.findall(html)
    if len(url2s) == 0:
        p = re.compile(r'(/Data/.+?)\'')
        url2s = p.findall(html)
        url2s = map(lambda x: "http://cdn.mynoise.net" + x, url2s)
    for u in url2s:
        u.replace("'", '')
        u2 = u + ".ogg"
        print u2
        u3 = u + ".mp3"
        filename = u2.replace("http://cdn.mynoise.net/", '')
        filepath = filename[:filename.rfind('/')]
        if os.path.exists(filepath) is False:
            os.makedirs(filepath)
            print "makedirs", filepath
        if os.path.exists(filepath + url[url.rfind('/'):]) is False:
            with open(filepath + url[url.rfind('/'):], 'w')as f:
                f.write(url + "\n" + u)

        if not os.path.exists(filename):
            success = False
            while not success:
                try:
                    print "start download", u2
                    r = s.get(u2, proxies=proxies, timeout=15)
                    with open(filename, "wb") as f:
                        f.write(r.content)
                    success = True
                except Exception, e:
                    print e.message, e.args
                    pass

        filename = u3.replace("http://cdn.mynoise.net/", '')
        if not os.path.exists(filename):
            success = False
            while not success:
                try:
                    print "start download", u3
                    r = s.get(u3, proxies=proxies, timeout=15)
                    with open(filename, "wb") as f:
                        f.write(r.content)
                    success = True
                except Exception, e:
                    print e.message, e.args
                    pass
